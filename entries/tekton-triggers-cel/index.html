<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Marco Paga"><meta name=description content="Master Tekton Triggers with Common Expression Language (CEL) for advanced webhook processing. Learn how to use CEL interceptors to manipulate git references and automate pipeline triggers in Kubernetes."><meta name=keywords content="[Tekton Triggers,CEL,Common Expression Language,Kubernetes,webhooks,git automation,interceptors,pipeline automation]"><meta property="article:published_time" content="2022-02-27T14:49:03+01:00"><meta property="article:modified_time" content="2022-02-27T14:49:03+01:00"><meta property="article:author" content="Marco Paga"><meta property="article:tag" content="Tekton"><meta property="article:tag" content="CEL"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="CI/CD"><meta property="article:tag" content="Webhooks"><meta property="article:tag" content="GitLab"><meta property="article:tag" content="GitHub"><meta property="article:tag" content="Automation"><meta property="og:site_name" content="Marco Paga"><meta property="og:title" content="
  Tekton Triggers CEL - Marco Paga
"><meta property="og:description" content="Master Tekton Triggers with Common Expression Language (CEL) for advanced webhook processing. Learn how to use CEL interceptors to manipulate git references and automate pipeline triggers in Kubernetes."><meta property="og:type" content="article"><meta property="og:url" content="https://marco-paga.eu/entries/tekton-triggers-cel/"><meta property="og:image" content="https://marco-paga.eu/images/tn.png"><meta name=twitter:card content="summary"><meta name=twitter:site content="@m_p_dus"><meta name=twitter:creator content="@m_p_dus"><meta name=twitter:title content="Tekton Triggers CEL"><meta name=twitter:description content="Master Tekton Triggers with Common Expression Language (CEL) for advanced webhook processing. Learn how to use CEL interceptors to manipulate git references and automate pipeline triggers in Kubernetes."><meta name=twitter:image content="https://marco-paga.eu/images/tn.png"><base href=https://marco-paga.eu/entries/tekton-triggers-cel/><title>Tekton Triggers CEL - Marco Paga</title><link rel=canonical href=https://marco-paga.eu/entries/tekton-triggers-cel/><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://marco-paga.eu/css/custom-aeo.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://marco-paga.eu/index.xml type=application/rss+xml title="Marco Paga"><link href=https://marco-paga.eu/index.xml rel=feed type=application/rss+xml title="Marco Paga"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Person","name":"Marco Paga","jobTitle":"Senior Solution Architect","worksFor":{"@type":"Organization","name":"codecentric AG"},"url":"https:\/\/marco-paga.eu\/","sameAs":["https://github.com/marcopaga/","https://twitter.com/m_p_dus/","https://www.linkedin.com/in/marco-paga-1925b2b1/"],"knowsAbout":["Cloud-Native Architecture","Kubernetes","DevOps","GitOps","Green IT","Platform Engineering","CI/CD","Tekton","GitHub Actions","Flux CD"],"description":"Marco Paga - Senior Solution Architect specializing in Cloud-Native Architecture, DevOps, and Green IT","image":"https:\/\/marco-paga.eu\/images\/bac-fra-avatar.png","hasCredential":[{"@type":"EducationalOccupationalCredential","credentialCategory":"certification","name":"Kubernetes for Developers Trainer"}],"award":["codecentric Community Award 2025 - Best Podcast or Vlog","codecentric Community Award 2024 - Best Podcast or Vlog"]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tekton Triggers CEL","name":"Tekton Triggers CEL","description":"Master Tekton Triggers with Common Expression Language (CEL) for advanced webhook processing. Learn how to use CEL interceptors to manipulate git references and automate pipeline triggers in Kubernetes.","author":{"@type":"Person","name":"Marco Paga"},"datePublished":"2022-02-27T14:49:03\u002b01:00","dateModified":"2022-02-27T14:49:03\u002b01:00","publisher":{"@type":"Person","name":"Marco Paga","url":"https:\/\/marco-paga.eu\/"},"image":"https:\/\/marco-paga.eu\/images\/tn.png","url":"https:\/\/marco-paga.eu\/entries\/tekton-triggers-cel\/","wordCount":385,"keywords":"[Tekton Triggers, CEL, Common Expression Language, Kubernetes, webhooks, git automation, interceptors, pipeline automation]","articleBody":"\"or how to convert a git ref to a branch name\\nTekton Triggers is a Tekton project which allows to receive webhooks and react appropriately to those. You can follow along my article on the codecentric blog to see what is possible.\\nTekton triggers includes a conecpt which is called Interceptors that provide a way to implement cross cutting concerns. To give you a quick example: If you integrate Github with Tekton you hopefully want to validate if your project is calling the tekton installation since you don\\u0026rsquo;t want anybody stumbling on your tekton installation to run pipelines. How hard can it be? Just have a look at the documentation and see that you need to exchange secrests and need to run HMAC on the encoded request. Long story short: Just integrate the GitHub interceptor and you are done.\\nAnd now another simple problem. When gitlab triggers a webhook the branch name is included in the request but contained in a git reference. This is great but what if I just need the branch name? One way to handle it is to create a task that gets the reference as a parameter and returns just the branch name as an out parameter. This is quite a big overhead so maybe there is a simpler solution.\\nCommon Expression Language Interceptor The common expression language is a simple expression language based on protobuf types. The implementation used in the context of tekton is the go implementation called cel-go. If you integrate the CEL interceptor in the EventListener you can manipulate the request and find the results in the trigger bindings in a field called extensions.\\nFind a short example here where I configured the interceptor to return the branch name:\\ntriggers: - name: gitlab-push-events-trigger interceptors: - name: \\u0026#34;verify-gitlab-payload\\u0026#34; ref: name: \\u0026#34;gitlab\\u0026#34; kind: ClusterInterceptor params: - name: secretRef value: secretName: \\u0026#34;gitlab-secret\\u0026#34; secretKey: \\u0026#34;secretToken\\u0026#34; - name: eventTypes value: - \\u0026#34;Push Hook\\u0026#34; - ref: name: cel params: - name: \\u0026#34;overlays\\u0026#34; value: - key: branch_name expression: \\u0026#34;body.ref.split(\\u0026#39;/\\u0026#39;)[2]\\u0026#34; bindings: - name: git-revision value: $(body.checkout_sha) - name: git-repository-url value: $(body.repository.git_http_url) - name: git-branch value: $(extensions.branch_name) The branch is extracted in the last two lines so these can be sent over to the triggered pipeline.\\nRecap As you can see we simply changed a request field to make it easily consumable from our pipeline.\\n\"","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/marco-paga.eu\/entries\/tekton-triggers-cel\/"}}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/marco-paga.eu\/"},{"@type":"ListItem","position":2,"name":"Entries","item":"https:\/\/marco-paga.eu\/entries\/"},{"@type":"ListItem","position":3,"name":"Tekton Triggers CEL","item":"https:\/\/marco-paga.eu\/entries\/tekton-triggers-cel\/"}]}</script><meta name=generator content="Hugo 0.152.2"></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Marco Paga</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class="navigation-item align-center"><a class=navigation-link href=https://marco-paga.eu/index.html>Start</a></li><li class="navigation-item align-center"><a class=navigation-link href=https://marco-paga.eu/articles>Articles</a></li><li class="navigation-item align-center"><a class=navigation-link href=https://marco-paga.eu/entries>Posts</a></li><li class="navigation-item align-center"><a class=navigation-link href=https://marco-paga.eu/about-me>About me</a></li><li class="navigation-item align-center"><a class=navigation-link href=https://marco-paga.eu/impressum>Imprint</a></li></ul></label></section></nav><div class=content><section class="container page"><article itemscope itemtype=https://schema.org/BlogPosting><header><h1 itemprop=headline>Tekton Triggers CEL</h1><div class=post-metadata><time itemprop=datePublished datetime=2022-02-27T14:49:03+01:00>Published: February 27, 2022
</time>&nbsp;•&nbsp;
<span class=reading-time>1 min read</span></div><div class=post-tags><span class=tag>Tekton</span><span class=tag>CEL</span><span class=tag>Kubernetes</span><span class=tag>CI/CD</span><span class=tag>Webhooks</span><span class=tag>GitLab</span><span class=tag>GitHub</span><span class=tag>Automation</span></div></header><div itemprop=articleBody><p><em>or how to convert a git ref to a branch name</em></p><p><a href=https://github.com/tektoncd/triggers>Tekton Triggers</a> is a Tekton project which allows to receive webhooks and react appropriately to those. You can follow along <a href=https://blog.codecentric.de/en/2022/03/tekton-triggers-in-practice/>my article on the codecentric blog</a> to see what is possible.</p><p>Tekton triggers includes a conecpt which is called <a href=https://github.com/tektoncd/triggers/blob/main/docs/interceptors.md>Interceptors</a> that provide a way to implement cross cutting concerns.
To give you a quick example: If you integrate Github with Tekton you hopefully want to validate if <strong>your</strong> project is calling the tekton installation since you don&rsquo;t want anybody stumbling on your tekton installation to run pipelines. How hard can it be? Just have a look at the <a href=https://docs.github.com/en/developers/webhooks-and-events/webhooks/securing-your-webhooks>documentation</a> and see that you need to exchange secrests and need to run HMAC on the encoded request. Long story short: Just integrate the <a href=https://github.com/tektoncd/triggers/blob/main/docs/interceptors.md#github-interceptors>GitHub</a> interceptor and you are done.</p><p>And now another simple problem. When gitlab triggers a webhook the branch name is included in the request but contained in a git reference. This is great but what if I just need the branch name?
One way to handle it is to create a task that gets the reference as a parameter and returns just the branch name as an out parameter. This is quite a big overhead so maybe there is a simpler solution.</p><h2 id=common-expression-language-interceptor>Common Expression Language Interceptor</h2><p>The common expression language is a simple expression language based on protobuf types. The implementation used in the context of tekton is the <a href=https://github.com/google/cel-go/>go implementation called cel-go</a>.
If you integrate the CEL interceptor in the EventListener you can manipulate the request and find the results in the trigger bindings in a field called <strong>extensions</strong>.</p><p>Find a short example here where I configured the interceptor to return the branch name:</p><pre tabindex=0><code> triggers:
    - name: gitlab-push-events-trigger
      interceptors:
        - name: &#34;verify-gitlab-payload&#34;
          ref:
            name: &#34;gitlab&#34;
            kind: ClusterInterceptor
          params:
            - name: secretRef
              value:
                secretName: &#34;gitlab-secret&#34;
                secretKey: &#34;secretToken&#34;
            - name: eventTypes
              value:
                - &#34;Push Hook&#34;
        - ref:
            name: cel
          params:
            - name: &#34;overlays&#34;
              value:
                - key: branch_name
                  expression: &#34;body.ref.split(&#39;/&#39;)[2]&#34;
      bindings:
        - name: git-revision
          value: $(body.checkout_sha)
        - name: git-repository-url
          value: $(body.repository.git_http_url)
        - name: git-branch
          value: $(extensions.branch_name)
</code></pre><p>The branch is extracted in the last two lines so these can be sent over to the triggered pipeline.</p><h2 id=recap>Recap</h2><p>As you can see we simply changed a request field to make it easily consumable from our pipeline.</p></div><footer class=post-footer><p>Written by <span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=name>Marco Paga</span></span></p></footer></article></section></div><footer class=footer><section class=container><div class="sns-shares sp-sns-shares"><a class="sns-share twitter-share" href="https://twitter.com/intent/tweet?original_referer=https%3a%2f%2fmarco-paga.eu%2fentries%2ftekton-triggers-cel%2f&ref_src=twsrc%5Etfw&text=Tekton%20Triggers%20CEL Marco%20Paga&tw_p=tweetbutton&url=https%3a%2f%2fmarco-paga.eu%2fentries%2ftekton-triggers-cel%2f"><i class="fab fa-twitter"></i></a>
<a class="sns-share linkedIn-share" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fmarco-paga.eu%2fentries%2ftekton-triggers-cel%2f"><i class="fab fa-linkedin"></i></a></div><p>✌️</p>Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/naro143/hugo-coder-portfolio>CoderPortfolio</a>.</section></footer><div class=fixed-bar><section class=container><div class="sns-shares pc-sns-shares"><a class="sns-share twitter-share" href="https://twitter.com/intent/tweet?original_referer=https%3a%2f%2fmarco-paga.eu%2fentries%2ftekton-triggers-cel%2f&ref_src=twsrc%5Etfw&text=Tekton%20Triggers%20CEL Marco%20Paga&tw_p=tweetbutton&url=https%3a%2f%2fmarco-paga.eu%2fentries%2ftekton-triggers-cel%2f"><i class="fab fa-twitter"></i></a>
<a class="sns-share linkedIn-share" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fmarco-paga.eu%2fentries%2ftekton-triggers-cel%2f"><i class="fab fa-linkedin"></i></a></div></section></div></main><script src=/js/app.js></script></body></html>